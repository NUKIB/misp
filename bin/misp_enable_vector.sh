#!/usr/bin/env bash
# Copyright (C) 2023 National Cyber and Information Security Agency of the Czech Republic
set -e

if [ -f "/etc/yum.repos.d/vector.repo" ]; then
    echo "vector repository is already enabled." >&2
    exit
fi

cat >/etc/yum.repos.d/vector.repo <<'EOL'
[vector]
name=Vector
baseurl=https://yum.vector.dev/stable/vector-0/$basearch/
enabled=1
gpgcheck=1
repo_gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/DATADOG_RPM_KEY_CURRENT.public
EOL

# https://keys.datadoghq.com/DATADOG_RPM_KEY_CURRENT.public
cat >/etc/pki/rpm-gpg/DATADOG_RPM_KEY_CURRENT.public <<'EOL'
-----BEGIN PGP PUBLIC KEY BLOCK-----

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
=8Ypd
-----END PGP PUBLIC KEY BLOCK-----
EOL